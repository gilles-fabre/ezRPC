<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RPC: Fuzz testing</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">RPC
   </div>
   <div id="projectbrief">EZ RPC C++ Windows/Linux interop</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md__c_1_2_dev_2ez_r_p_c_2_r_p_c_2json_2tests_2fuzzing.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Fuzz testing</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md1818"></a> Each parser of the library (JSON, BJData, BSON, CBOR, MessagePack, and UBJSON) can be fuzz tested. Currently, <a href="https://llvm.org/docs/LibFuzzer.html">libFuzzer</a> and <a href="https://github.com/AFLplusplus/AFLplusplus">afl++</a> are supported.</p>
<h1><a class="anchor" id="autotoc_md1819"></a>
Corpus creation</h1>
<p>For most effective fuzzing, a <a href="https://llvm.org/docs/LibFuzzer.html#corpus">corpus</a> should be provided. A corpus is a directory with some simple input files that cover several features of the parser and is hence a good starting point for mutations.</p>
<div class="fragment"><div class="line">TEST_DATA_VERSION=3.1.0</div>
<div class="line">wget https://github.com/nlohmann/json_test_data/archive/refs/tags/v$TEST_DATA_VERSION.zip</div>
<div class="line">unzip v$TEST_DATA_VERSION.zip</div>
<div class="line">rm v$TEST_DATA_VERSION.zip</div>
<div class="line">for FORMAT in json bjdata bson cbor msgpack ubjson</div>
<div class="line">do</div>
<div class="line">  rm -fr corpus_$FORMAT</div>
<div class="line">  mkdir corpus_$FORMAT</div>
<div class="line">  find json_test_data-$TEST_DATA_VERSION -size -5k -name &quot;*.$FORMAT&quot; -exec cp &quot;{}&quot; &quot;corpus_$FORMAT&quot; \;</div>
<div class="line">done</div>
<div class="line">rm -fr json_test_data-$TEST_DATA_VERSION</div>
</div><!-- fragment --><p>The generated corpus can be used with both libFuzzer and afl++. The remainder of this documentation assumes the corpus directories have been created in the <code>tests</code> directory.</p>
<h1><a class="anchor" id="autotoc_md1820"></a>
libFuzzer</h1>
<p>To use libFuzzer, you need to pass <code>-fsanitize=fuzzer</code> as <code>FUZZER_ENGINE</code>. In the <code>tests</code> directory, call</p>
<div class="fragment"><div class="line">make fuzzers FUZZER_ENGINE=&quot;-fsanitize=fuzzer&quot;</div>
</div><!-- fragment --><p>This creates a fuzz tester binary for each parser that supports these <a href="https://llvm.org/docs/LibFuzzer.html#options">command line options</a>.</p>
<p>In case your default compiler is not a Clang compiler that includes libFuzzer (Clang 6.0 or later), you need to set the <code>CXX</code> variable accordingly. Note the compiler provided by Xcode (AppleClang) does not contain libFuzzer. Please install Clang via Homebrew calling <code>brew install llvm</code> and add <code>CXX=$(brew --prefix llvm)/bin/clang</code> to the <code>make</code> call:</p>
<div class="fragment"><div class="line">make fuzzers FUZZER_ENGINE=&quot;-fsanitize=fuzzer&quot; CXX=$(brew --prefix llvm)/bin/clang</div>
</div><!-- fragment --><p>Then pass the corpus directory as command-line argument (assuming it is located in <code>tests</code>):</p>
<div class="fragment"><div class="line">./parse_cbor_fuzzer corpus_cbor</div>
</div><!-- fragment --><p>The fuzzer should be able to run indefinitely without crashing. In case of a crash, the tested input is dumped into a file starting with <code>crash-</code>.</p>
<h1><a class="anchor" id="autotoc_md1821"></a>
afl++</h1>
<p>To use afl++, you need to pass <code>-fsanitize=fuzzer</code> as <code>FUZZER_ENGINE</code>. It will be replaced by a <code>libAFLDriver.a</code> to re-use the same code written for libFuzzer with afl++. Furthermore, set <code>afl-clang-fast++</code> as compiler.</p>
<div class="fragment"><div class="line">CXX=afl-clang-fast++ make fuzzers FUZZER_ENGINE=&quot;-fsanitize=fuzzer&quot; </div>
</div><!-- fragment --><p>Then the fuzzer is called like this in the <code>tests</code> directory:</p>
<div class="fragment"><div class="line">afl-fuzz -i corpus_cbor -o out  -- ./parse_cbor_fuzzer </div>
</div><!-- fragment --><p>The fuzzer should be able to run indefinitely without crashing. In case of a crash, the tested input is written to the directory <code>out</code>.</p>
<h1><a class="anchor" id="autotoc_md1822"></a>
OSS-Fuzz</h1>
<p>The library is further fuzz-tested 24/7 by Google's <a href="https://github.com/google/oss-fuzz">OSS-Fuzz project</a>. It uses the same <code>fuzzers</code> target as above and also relies on the <code>FUZZER_ENGINE</code> variable. See the used <a href="https://github.com/google/oss-fuzz/blob/master/projects/json/build.sh">build script</a> for more information.</p>
<p>In case the build at OSS-Fuzz fails, an issue will be created automatically. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
